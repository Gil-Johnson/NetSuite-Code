/*! print-picking-ticket 23-08-2016 */
function TooltipManager(a){var b=!0;a.showCustomerQuickView=function(a,c){if(b){b=!1;try{displayCustomerQuickView(a,c)}catch(a){console.error(a)}}else displayCustomerQuickView(a,c)},a.hideCustomerQuickView=function(a){},a.displayCustomerQuickView=function(b,c){try{var d=!1,e="custname_anchor_"+c,f="undefined"!=typeof parent.getExtTooltip&&parent.getExtTooltip?parent:window;if("undefined"!=typeof f.getExtTooltip){var g=f.getExtTooltip(e,"entity","DEFAULT_TEMPLATE",b,null);void 0!=g&&(g.show(),d=!0)}0==d&&setTimeout(function(){a.displayCustomerQuickView(b,c)},2e3)}catch(a){}},a.showItemQuickView=function(a,c,d){if(b){b=!1;try{displayItemQuickView(a,c,d)}catch(a){}setTimeout(function(){displayItemQuickView(a,c,d)},5e3)}else displayItemQuickView(a,c,d)},a.displayItemQuickView=function(a,b,c){var d="itemdesc_anchor_"+b,e="undefined"!=typeof parent.getExtTooltip&&parent.getExtTooltip?parent:window;if("undefined"!=typeof e.getExtTooltip){var f=e.getExtTooltip(d,"ITEM","CONTACT_TEMPLATE",a,null);void 0!=f&&(console.log("showing item tooltip"),f.onTargetOver(c))}}}function StateManager(a,b){var c=a,d=b;this.clearState=function(){$.jStorage.flush()},this.saveCurrentState=function(a){console.log("saveCurrentState();");var b=StopWatch.start("saveCurrentState()"),c=this.getSelectedData();console.log("saveCurrentState(); // data = ",c),$.jStorage.set(d+"_uidata_"+a,c),console.log("saveCurrentState(); // page = ",a),console.log("saveCurrentState(); // saved data = ",$.jStorage.get(d+"_uidata_"+a)),b.stop()},this.reloadCurrentState=function(a){console.log("reloadCurrentState();");var b=StopWatch.start("reloadCurrentState()"),e=$.jStorage.get(d+"_uidata_"+a);if(console.log("reloadCurrentState(); // page = ",a),console.log("reloadCurrentState(); // data = ",e),e){var f=e.checkbox.prints;c.find(".print-checkbox").filter(function(){var a=this.getAttribute("data-salesorder-id");return f.indexOf(a)>-1}).prop("checked",!0);var g=e.checkbox.items,h=e.checkbox.orders,i=c.find(".close-checkbox").filter(function(){var a=this.getAttribute("data-salesorder-id"),b=this.getAttribute("data-item-id");if(b){var c=_.matcher({order:a,item:b});return _.findIndex(g,c)>-1}return h.indexOf(a)>-1});i.prop("checked",!1).click();var j=c.find("tr[id]");_.each(e.salesorders,function(a,b,c){var d=a,e=d.row_id,f=j.filter("#"+e);if(d.ship_date!=d.orig_ship_date){var g=f.find(".input-group.ship-date");g.attr("data-orig-value",d.orig_ship_date),g.datepicker("setDate",d.ship_date),f.addClass("modified-ship-date")}if(d.cancel_date!=d.orig_cancel_date){var h=f.find(".input-group.cancel-date");h.attr("data-orig-value",d.orig_cancel_date),h.datepicker("setDate",d.cancel_date),f.addClass("modified-cancel-date")}_.each(d.items,function(a,b){var c=j.filter("#"+a.row_id);if(1==a.item_modified){c.find(".close-checkbox").attr("data-item-id",a.item_text);var d=c.find(".item-picker");d.attr("data-orig-value",a.orig_item_text),d.attr("data-selected-id",a.item_id),d.attr("data-selected-text",a.item_text),d.val(a.item_text),c.addClass("modified-item")}if(a.ship_date!=a.orig_ship_date){var e=c.find(".input-group.ship-date");e.attr("data-orig-value",a.orig_ship_date),e.datepicker("setDate",a.ship_date),c.addClass("modified-ship-date")}})}),b.stop()}},this.getSelectedData=function(){var a={checkbox:{orders:[],items:[],prints:[],approves:[],emails:[]},salesorders:{}},b=c.find(".print-checkbox").filter(":checked"),bb=c.find(".approve-checkbox").filter(":checked"),ba = c.find(".email-checkbox").filter(":checked"),d=c.find(".close-checkbox").filter(":not(:disabled):checked");d.each(function(){var b=this.parentNode.parentNode,c=this.getAttribute("data-salesorder-id"),d=this.getAttribute("data-item-id"),e=b.getAttribute("data-line-id"),cr=$('#'+c).val();d?a.checkbox.items.push({order:c,item:d,lineId:e}):a.checkbox.orders.push({nsid:c,closed:$('#'+c).val()})});var e=b.map(function(){return this.getAttribute("data-salesorder-id")}).toArray();var ee=bb.map(function(){return this.getAttribute("data-salesorder-id")}).toArray();var ea=ba.map(function(){return this.getAttribute("data-salesorder-id")}).toArray();a.checkbox.prints=a.checkbox.prints.concat(e);a.checkbox.approves = a.checkbox.approves.concat(ee);a.checkbox.emails = a.checkbox.emails.concat(ea);var f={},g=$(".modified-item, .modified-ship-date, .modified-cancel-date");return g.each(function(){var a=$(this),b=a.find(".item-picker"),c=a.find(".input-group.ship-date"),d=a.find(".input-group.cancel-date"),e=this.getAttribute("id"),g="true"===this.getAttribute("data-is-mainline"),h=this.getAttribute("data-salesorder-id"),i=b.attr("data-selected-id"),j=b.attr("data-selected-text"),k=b.attr("data-orig-value"),l=this.getAttribute("data-line-id"),m=a.hasClass("modified-item"),n=d.datepicker("getDate"),o=d.attr("data-orig-value"),qv=a.find('.swap-qty'),newQty=qv.attr('data-new-value'),p=g&&n&&n instanceof Date?n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear():"",q=c.datepicker("getDate"),r=c.attr("data-orig-value"),s=q?q.getMonth()+1+"/"+q.getDate()+"/"+q.getFullYear():"";f[h]=f[h]||{},f[h].items=f[h].items||[],f[h].id=h,g?(f[h].ship_date=s,f[h].orig_ship_date=r,f[h].cancel_date=p,f[h].orig_cancel_date=o,f[h].row_id=e):f[h].items.push({line_id:l,item_id:i,item_text:j,orig_item_text:k,item_modified:m,row_id:e,ship_date:s,orig_ship_date:r,newQty:newQty})}),a.salesorders=f,a},this.getAllData=function(){for(var a={checkbox:{orders:[],items:[],prints:[],approves:[],emails:[]},salesorders:{}},b=[],c=1;c<=100;c++){var e=$.jStorage.get(d+"_uidata_"+c);e&&(b.push(e),a.checkbox.items=a.checkbox.items.concat(e.checkbox.items),a.checkbox.orders=a.checkbox.orders.concat(e.checkbox.orders),a.checkbox.prints=a.checkbox.prints.concat(e.checkbox.prints),a.checkbox.approves = a.checkbox.approves.concat(e.checkbox.approves),a.checkbox.emails = a.checkbox.emails.concat(e.checkbox.emails),_.extend(a.salesorders,e.salesorders))}return a}}function DataManager(a){function b(a,b,c){console.log("getSalesOrdersFromServer()");var d=k(),e={action:"get_salesorders"};console.log("startIndex: ",b),a.startIndex=b;var f={params:JSON.stringify(a)};console.log("filters: ",f),$.extend(e,f),jQuery.get(d,e,function(a){console.log("jquery complete: ",arguments),200===a.status_code?(_.each(a.data,function(a,b){a.guid=l(),a.recid=a.guid,a.mainline=!a.item}),_.chain(a.data).where({mainline:!0}).each(function(b,c){console.log(b);var d=0;_.chain(a.data).where({id:b.id}).each(function(a,b){d+=parseInt(a.quantity_committed)});b.quantity_committed=d})):console.error("error while fetching data from server: ",arguments),c&&c(a)})}function c(a){var b=k();jQuery.get(b,{action:"get_partners"},function(b){console.log("getPartners(); // jquery complete: ",arguments),a&&a(b)})}function d(a){var b=k();jQuery.get(b,{action:"get_product_types"},function(b){console.log("getPartners(); // jquery complete: ",arguments),a&&a(b)})}function e(a){var b=k();jQuery.get(b,{action:"get_locations"},function(b){console.log("getLocations(); // jquery complete: ",arguments),a&&a(b)})}function f(a){var b=k(),c={action:"get_leagues"};jQuery.get(b,c,function(b){console.log("getLeaguesFromServer(); // jquery complete: ",arguments),a&&a(b)})}function g(a,b){var c=k(),d={action:"get_teams"},e={params:JSON.stringify(a)};$.extend(d,e),jQuery.get(c,d,function(a){console.log("getTeamsFromServer(); // jquery complete: ",arguments),b&&b(a)})}function h(a,b,c,d){console.log("split 2()");for(var e=0,f={},g=_.clone(a),h=g.length;e<h;){console.log("pickedItemsCount: ",e),console.log("clonedItemLength: ",h);var i=_.chain(g).drop(e).take(c);console.log("records.length: ",i.value().length);for(var j=e+c,k=j;k<h;k++){var l=g[k];if(!l.item)break;i.push(l)}var m=i.value();console.log("records.length: ",m.length),e+=m.length,f[d++]=m,console.log("pageIndex: ",d)}return f}var i=null,j=a,k=function(){return i||(i=window.apiSuiteletUrl,i+="&type="+j),i},l=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();this.getSalesOrders=function(a,c,d){var e=j+"_"+_.values(a).join("_"),f=$.jStorage.get(e);if(f&&f[c])d&&d(f[c]);else{f||(f={});var g=0;f[c-1]&&(g=_.chain(f).values().flatten().size().value()),b(a,g,function(a){if(200===a.status_code){var b=525,g=a.data,i=h(g,"id",b,c);f=_.extend(f,i);var j=f[c]||[];console.log("splittedItems: ",i),console.log("data: ",f),console.log("page: ",c),console.log("data[page]: ",j);var k=1e3,l=60*k,m=60*l;$.jStorage.set(e,f,{TTL:m}),d&&d(j)}else console.error("error while fetching data from server: ",arguments)})}},this.getPartners=function(a){var b="partners",d=$.jStorage.get(b);d?a&&a(d):c(function(c){$.jStorage.set(b,c),a&&a(c)})},this.getProductTypes=function(a){var b="product_types",c=$.jStorage.get(b);c?a&&a(c):d(function(c){$.jStorage.set(b,c),a&&a(c)})},this.getLocations=function(a){var b="locations",c=$.jStorage.get(b);c?a&&a(c):e(function(c){$.jStorage.set(b,c),a&&a(c)})},this.getLeagues=function(a){console.log("getLeagues();");var b="leagues",c=$.jStorage.get(b);c?a&&a(c):f(function(c){$.jStorage.set(b,c),a&&a(c)})},this.getTeams=function(a,b){a=a||{};var c="teams_"+a.league_id,d=$.jStorage.get(c);d?b&&b(d):g(a,function(a){$.jStorage.set(c,a),b&&b(a)})},this.getCustomers=function(a,b){try{var c=k(),d={action:"get_customers"},e={params:JSON.stringify(a)};$.extend(d,e),jQuery.get(c,d,function(a){console.log("getCustomers(); // jquery complete: ",arguments),b&&b(a)})}catch(a){console.error("ERROR","Error during main DataManager.getCustomers()",a.toString()),b&&b(null)}},this.getItems=function(a,b){try{var c=k(),d={action:"get_items"},e={params:JSON.stringify(a)};$.extend(d,e),jQuery.get(c,d,function(a){console.log("getCustomers(); // jquery complete: ",arguments),b&&b(a)})}catch(a){console.error("ERROR","Error during main DataManager.getCustomers()",a.toString()),b&&b(null)}},this.submit=function(a,b){var c=k(),d={action:"submit"};$.extend(d,{params:JSON.stringify(a)}),jQuery.post(c,d,function(a){console.log("submit(); // jquery complete: ",arguments),b&&b(a)})}}(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&d!==-1?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-1/0,g=-1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-1/0&&f===-1/0)&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||1/0===e&&1/0===f)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a||(A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length)},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(a){throw a.source=f,a}var h=function(a){return g.call(this,a,s)},i=b.variable||"obj";return h.source="function("+i+"){\n"+f+"}",h},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}).call(this),function(){!function(a,b){"object"==typeof exports?module.exports=b(this):"function"==typeof define&&define.amd?define(function(){return b(a)}):a.Fiber=b(a)}(this,function(a){function b(a,b){var c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c])}function c(){}var d=!1,e=Array.prototype,f=a.Fiber;return c.extend=function(a){function e(){d||(this.init.apply(this,arguments),this.init=void 0)}var f,g=this.prototype,h=a(g);return d=!0,f=e.prototype=new this,d=!1,f.init=function(){"function"==typeof g.init&&g.init.apply(this,arguments)},b(h,f),f.constructor=e,e.__base__=g,e.extend=e.prototype.extend||c.extend,e},c.proxy=function(a,b){var c,d,e={};1===arguments.length&&(b=a,a=b.constructor.__base__),d=function(c){return function(){return a[c].apply(b,arguments)}};for(c in a)a.hasOwnProperty(c)&&"function"==typeof a[c]&&(e[c]=d(c));return e},c.decorate=function(a){var c,d=a.constructor.__base__,f=e.slice.call(arguments,1),g=f.length;for(c=0;c<g;c++)b(f[c].call(a,d),a)},c.mixin=function(a){var c,d=a.__base__,f=e.slice.call(arguments,1),g=f.length;for(c=0;c<g;c++)b(f[c](d),a.prototype)},c.noConflict=function(){return a.Fiber=f,c},c})}(),function(){"use strict";function a(){var a=!1;if("localStorage"in window)try{window.localStorage.setItem("_tmptest","tmpval"),a=!0,window.localStorage.removeItem("_tmptest")}catch(a){}if(a)try{window.localStorage&&(v=window.localStorage,y="localStorage",B=v.jStorage_update)}catch(a){}else if("globalStorage"in window)try{window.globalStorage&&(v="localhost"==window.location.hostname?window.globalStorage["localhost.localdomain"]:window.globalStorage[window.location.hostname],y="globalStorage",B=v.jStorage_update)}catch(a){}else{if(w=document.createElement("link"),!w.addBehavior)return void(w=null);w.style.behavior="url(#default#userData)",document.getElementsByTagName("head")[0].appendChild(w);try{w.load("jStorage")}catch(a){w.setAttribute("jStorage","{}"),w.save("jStorage"),w.load("jStorage")}var b="{}";try{b=w.getAttribute("jStorage")}catch(a){}try{B=w.getAttribute("jStorage_update")}catch(a){}v.jStorage=b,y="userDataBehavior"}h(),k(),c(),l(),"addEventListener"in window&&window.addEventListener("pageshow",function(a){a.persisted&&d()},!1)}function b(){var a="{}";if("userDataBehavior"==y){w.load("jStorage");try{a=w.getAttribute("jStorage")}catch(a){}try{B=w.getAttribute("jStorage_update")}catch(a){}v.jStorage=a}h(),k(),l()}function c(){"localStorage"==y||"globalStorage"==y?"addEventListener"in window?window.addEventListener("storage",d,!1):document.attachEvent("onstorage",d):"userDataBehavior"==y&&setInterval(d,1e3)}function d(){var a;clearTimeout(A),A=setTimeout(function(){if("localStorage"==y||"globalStorage"==y)a=v.jStorage_update;else if("userDataBehavior"==y){w.load("jStorage");try{a=w.getAttribute("jStorage_update")}catch(a){}}a&&a!=B&&(B=a,e())},25)}function e(){var a,c=s.parse(s.stringify(u.__jstorage_meta.CRC32));b(),a=s.parse(s.stringify(u.__jstorage_meta.CRC32));var d,e=[],g=[];for(d in c)if(c.hasOwnProperty(d)){if(!a[d]){g.push(d);continue}c[d]!=a[d]&&"2."==String(c[d]).substr(0,2)&&e.push(d)}for(d in a)a.hasOwnProperty(d)&&(c[d]||e.push(d));f(e,"updated"),f(g,"deleted")}function f(a,b){a=[].concat(a||[]);var c,d,e,f;if("flushed"==b){a=[];for(var g in z)z.hasOwnProperty(g)&&a.push(g);b="deleted"}for(c=0,e=a.length;c<e;c++){if(z[a[c]])for(d=0,f=z[a[c]].length;d<f;d++)z[a[c]][d](a[c],b);if(z["*"])for(d=0,f=z["*"].length;d<f;d++)z["*"][d](a[c],b)}}function g(){var a=(+new Date).toString();if("localStorage"==y||"globalStorage"==y)try{v.jStorage_update=a}catch(a){y=!1}else"userDataBehavior"==y&&(w.setAttribute("jStorage_update",a),w.save("jStorage"));d()}function h(){if(v.jStorage)try{u=s.parse(String(v.jStorage))}catch(a){v.jStorage="{}"}else v.jStorage="{}";x=v.jStorage?String(v.jStorage).length:0,u.__jstorage_meta||(u.__jstorage_meta={}),u.__jstorage_meta.CRC32||(u.__jstorage_meta.CRC32={})}function i(){n();try{v.jStorage=s.stringify(u),w&&(w.setAttribute("jStorage",v.jStorage),w.save("jStorage")),x=v.jStorage?String(v.jStorage).length:0}catch(a){}}function j(a){if("string"!=typeof a&&"number"!=typeof a)throw new TypeError("Key name must be string or numeric");if("__jstorage_meta"==a)throw new TypeError("Reserved key name");return!0}function k(){var a,b,c,d,e=1/0,h=!1,j=[];if(clearTimeout(t),u.__jstorage_meta&&"object"==typeof u.__jstorage_meta.TTL){a=+new Date,c=u.__jstorage_meta.TTL,d=u.__jstorage_meta.CRC32;for(b in c)c.hasOwnProperty(b)&&(c[b]<=a?(delete c[b],delete d[b],delete u[b],h=!0,j.push(b)):c[b]<e&&(e=c[b]));e!=1/0&&(t=setTimeout(k,Math.min(e-a,2147483647))),h&&(i(),g(),f(j,"deleted"))}}function l(){var a,b;if(u.__jstorage_meta.PubSub){var c,d=D,e=[];for(a=b=u.__jstorage_meta.PubSub.length-1;a>=0;a--)c=u.__jstorage_meta.PubSub[a],c[0]>D&&(d=c[0],e.unshift(c));for(a=e.length-1;a>=0;a--)m(e[a][1],e[a][2]);D=d}}function m(a,b){if(C[a])for(var c=0,d=C[a].length;c<d;c++)try{C[a][c](a,s.parse(s.stringify(b)))}catch(a){}}function n(){if(u.__jstorage_meta.PubSub){for(var a=+new Date-2e3,b=0,c=u.__jstorage_meta.PubSub.length;b<c;b++)if(u.__jstorage_meta.PubSub[b][0]<=a){u.__jstorage_meta.PubSub.splice(b,u.__jstorage_meta.PubSub.length-b);break}u.__jstorage_meta.PubSub.length||delete u.__jstorage_meta.PubSub}}function o(a,b){u.__jstorage_meta||(u.__jstorage_meta={}),u.__jstorage_meta.PubSub||(u.__jstorage_meta.PubSub=[]),u.__jstorage_meta.PubSub.unshift([+new Date,a,b]),i(),g()}function p(a,b){for(var c,d=a.length,e=b^d,f=0;d>=4;)c=255&a.charCodeAt(f)|(255&a.charCodeAt(++f))<<8|(255&a.charCodeAt(++f))<<16|(255&a.charCodeAt(++f))<<24,c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16),c^=c>>>24,c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16),e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16)^c,d-=4,++f;switch(d){case 3:e^=(255&a.charCodeAt(f+2))<<16;case 2:e^=(255&a.charCodeAt(f+1))<<8;case 1:e^=255&a.charCodeAt(f),e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16)}return e^=e>>>13,e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16),e^=e>>>15,e>>>0}var q="0.4.12",r=window.jQuery||window.$||(window.$={}),s={parse:window.JSON&&(window.JSON.parse||window.JSON.decode)||String.prototype.evalJSON&&function(a){return String(a).evalJSON()}||r.parseJSON||r.evalJSON,stringify:Object.toJSON||window.JSON&&(window.JSON.stringify||window.JSON.encode)||r.toJSON};if("function"!=typeof s.parse||"function"!=typeof s.stringify)throw new Error("No JSON support found, include //cdnjs.cloudflare.com/ajax/libs/json2/20110223/json2.js to page");
var t,u={__jstorage_meta:{CRC32:{}}},v={jStorage:"{}"},w=null,x=0,y=!1,z={},A=!1,B=0,C={},D=+new Date,E={isXML:function(a){var b=(a?a.ownerDocument||a:0).documentElement;return!!b&&"HTML"!==b.nodeName},encode:function(a){if(!this.isXML(a))return!1;try{return(new XMLSerializer).serializeToString(a)}catch(b){try{return a.xml}catch(a){}}return!1},decode:function(a){var b,c="DOMParser"in window&&(new DOMParser).parseFromString||window.ActiveXObject&&function(a){var b=new ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b};return!!c&&(b=c.call("DOMParser"in window&&new DOMParser||window,a,"text/xml"),!!this.isXML(b)&&b)}};r.jStorage={version:q,set:function(a,b,c){if(j(a),c=c||{},"undefined"==typeof b)return this.deleteKey(a),b;if(E.isXML(b))b={_is_xml:!0,xml:E.encode(b)};else{if("function"==typeof b)return;b&&"object"==typeof b&&(b=s.parse(s.stringify(b)))}return u[a]=b,u.__jstorage_meta.CRC32[a]="2."+p(s.stringify(b),2538058380),this.setTTL(a,c.TTL||0),f(a,"updated"),b},get:function(a,b){return j(a),a in u?u[a]&&"object"==typeof u[a]&&u[a]._is_xml?E.decode(u[a].xml):u[a]:"undefined"==typeof b?null:b},deleteKey:function(a){return j(a),a in u&&(delete u[a],"object"==typeof u.__jstorage_meta.TTL&&a in u.__jstorage_meta.TTL&&delete u.__jstorage_meta.TTL[a],delete u.__jstorage_meta.CRC32[a],i(),g(),f(a,"deleted"),!0)},setTTL:function(a,b){var c=+new Date;return j(a),b=Number(b)||0,a in u&&(u.__jstorage_meta.TTL||(u.__jstorage_meta.TTL={}),b>0?u.__jstorage_meta.TTL[a]=c+b:delete u.__jstorage_meta.TTL[a],i(),k(),g(),!0)},getTTL:function(a){var b,c=+new Date;return j(a),a in u&&u.__jstorage_meta.TTL&&u.__jstorage_meta.TTL[a]?(b=u.__jstorage_meta.TTL[a]-c,b||0):0},flush:function(){return u={__jstorage_meta:{CRC32:{}}},i(),g(),f(null,"flushed"),!0},storageObj:function(){function a(){}return a.prototype=u,new a},index:function(){var a,b=[];for(a in u)u.hasOwnProperty(a)&&"__jstorage_meta"!=a&&b.push(a);return b},storageSize:function(){return x},currentBackend:function(){return y},storageAvailable:function(){return!!y},listenKeyChange:function(a,b){j(a),z[a]||(z[a]=[]),z[a].push(b)},stopListening:function(a,b){if(j(a),z[a]){if(!b)return void delete z[a];for(var c=z[a].length-1;c>=0;c--)z[a][c]==b&&z[a].splice(c,1)}},subscribe:function(a,b){if(a=(a||"").toString(),!a)throw new TypeError("Channel not defined");C[a]||(C[a]=[]),C[a].push(b)},publish:function(a,b){if(a=(a||"").toString(),!a)throw new TypeError("Channel not defined");o(a,b)},reInit:function(){b()},noConflict:function(a){return delete window.$.jStorage,a&&(window.jStorage=this),this}},a()}();var StopWatch=function(){function a(){this._startTime=null,this._endTime=null,this._elapsedTime=null,this._title=null,this.start=function(a){this._startTime=new Date,this._title=a},this.stop=function(){this._endTime=new Date,this._elapsedTime=this._endTime-this._startTime;var a=this._elapsedTime+" milliseconds ",b=(this._elapsedTime/1e3).toFixed(2)+" seconds",c="Method Name: "+this._title,d=c+" --- "+a+" --- "+b;window.console&&window.console.log("DEBUG","Method Execution Time",d)}}return{start:function(b){var c=new a;return c.start(b),c}}}();!function(a,b){"function"==typeof define&&define.amd?define("typeahead.js",["jquery"],function(a){return b(a)}):"object"==typeof exports?module.exports=b(require("jquery")):b(jQuery)}(this,function(a){var b=function(){"use strict";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(a){return!a||/^\s*$/.test(a)},escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(a){return"undefined"==typeof a},isElement:function(a){return!(!a||1!==a.nodeType)},isJQuery:function(b){return b instanceof a},toStr:function(a){return b.isUndefined(a)||null===a?"":a+""},bind:a.proxy,each:function(b,c){function d(a,b){return c(b,a)}a.each(b,d)},map:a.map,filter:a.grep,every:function(b,c){var d=!0;return b?(a.each(b,function(a,e){return!!(d=c.call(null,e,a,b))&&void 0}),!!d):d},some:function(b,c){var d=!1;return b?(a.each(b,function(a,e){return!(d=c.call(null,e,a,b))&&void 0}),!!d):d},mixin:a.extend,identity:function(a){return a},clone:function(b){return a.extend(!0,{},b)},getIdGenerator:function(){var a=0;return function(){return a++}},templatify:function(b){function c(){return String(b)}return a.isFunction(b)?b:c},defer:function(a){setTimeout(a,0)},debounce:function(a,b,c){var d,e;return function(){var f,g,h=this,i=arguments;return f=function(){d=null,c||(e=a.apply(h,i))},g=c&&!d,clearTimeout(d),d=setTimeout(f,b),g&&(e=a.apply(h,i)),e}},throttle:function(a,b){var c,d,e,f,g,h;return g=0,h=function(){g=new Date,e=null,f=a.apply(c,d)},function(){var i=new Date,j=b-(i-g);return c=this,d=arguments,0>=j?(clearTimeout(e),e=null,g=i,f=a.apply(c,d)):e||(e=setTimeout(h,j)),f}},stringify:function(a){return b.isString(a)?a:JSON.stringify(a)},noop:function(){}}}(),c=function(){"use strict";function a(a){var g,h;return h=b.mixin({},f,a),g={css:e(),classes:h,html:c(h),selectors:d(h)},{css:g.css,html:g.html,classes:g.classes,selectors:g.selectors,mixin:function(a){b.mixin(a,g)}}}function c(a){return{wrapper:'<span class="'+a.wrapper+'"></span>',menu:'<div class="'+a.menu+'"></div>'}}function d(a){var c={};return b.each(a,function(a,b){c[b]="."+a}),c}function e(){var a={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},menu:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return b.isMsie()&&b.mixin(a.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),a}var f={wrapper:"twitter-typeahead",input:"tt-input",hint:"tt-hint",menu:"tt-menu",dataset:"tt-dataset",suggestion:"tt-suggestion",selectable:"tt-selectable",empty:"tt-empty",open:"tt-open",cursor:"tt-cursor",highlight:"tt-highlight"};return a}(),d=function(){"use strict";function c(b){b&&b.el||a.error("EventBus initialized without el"),this.$el=a(b.el)}var d,e;return d="typeahead:",e={render:"rendered",cursorchange:"cursorchanged",select:"selected",autocomplete:"autocompleted"},b.mixin(c.prototype,{_trigger:function(b,c){var e;return e=a.Event(d+b),(c=c||[]).unshift(e),this.$el.trigger.apply(this.$el,c),e},before:function(a){var b,c;return b=[].slice.call(arguments,1),c=this._trigger("before"+a,b),c.isDefaultPrevented()},trigger:function(a){var b;this._trigger(a,[].slice.call(arguments,1)),(b=e[a])&&this._trigger(b,[].slice.call(arguments,1))}}),c}(),e=function(){"use strict";function a(a,b,c,d){var e;if(!c)return this;for(b=b.split(i),c=d?h(c,d):c,this._callbacks=this._callbacks||{};e=b.shift();)this._callbacks[e]=this._callbacks[e]||{sync:[],async:[]},this._callbacks[e][a].push(c);return this}function b(b,c,d){return a.call(this,"async",b,c,d)}function c(b,c,d){return a.call(this,"sync",b,c,d)}function d(a){var b;if(!this._callbacks)return this;for(a=a.split(i);b=a.shift();)delete this._callbacks[b];return this}function e(a){var b,c,d,e,g;if(!this._callbacks)return this;for(a=a.split(i),d=[].slice.call(arguments,1);(b=a.shift())&&(c=this._callbacks[b]);)e=f(c.sync,this,[b].concat(d)),g=f(c.async,this,[b].concat(d)),e()&&j(g);return this}function f(a,b,c){function d(){for(var d,e=0,f=a.length;!d&&f>e;e+=1)d=a[e].apply(b,c)===!1;return!d}return d}function g(){var a;return a=window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}}function h(a,b){return a.bind?a.bind(b):function(){a.apply(b,[].slice.call(arguments,0))}}var i=/\s+/,j=g();return{onSync:c,onAsync:b,off:d,trigger:e}}(),f=function(a){"use strict";function c(a,c,d){for(var e,f=[],g=0,h=a.length;h>g;g++)f.push(b.escapeRegExChars(a[g]));return e=d?"\\b("+f.join("|")+")\\b":"("+f.join("|")+")",c?new RegExp(e):new RegExp(e,"i")}var d={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(e){function f(b){var c,d,f;return(c=h.exec(b.data))&&(f=a.createElement(e.tagName),e.className&&(f.className=e.className),d=b.splitText(c.index),d.splitText(c[0].length),f.appendChild(d.cloneNode(!0)),b.parentNode.replaceChild(f,d)),!!c}function g(a,b){for(var c,d=3,e=0;e<a.childNodes.length;e++)c=a.childNodes[e],c.nodeType===d?e+=b(c)?1:0:g(c,b)}var h;e=b.mixin({},d,e),e.node&&e.pattern&&(e.pattern=b.isArray(e.pattern)?e.pattern:[e.pattern],h=c(e.pattern,e.caseSensitive,e.wordsOnly),g(e.node,f))}}(window.document),g=function(){"use strict";function c(c,e){c=c||{},c.input||a.error("input is missing"),e.mixin(this),this.$hint=a(c.hint),this.$input=a(c.input),this.query=this.$input.val(),this.queryWhenFocused=this.hasFocus()?this.query:null,this.$overflowHelper=d(this.$input),this._checkLanguageDirection(),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=b.noop)}function d(b){return a('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:b.css("font-family"),fontSize:b.css("font-size"),fontStyle:b.css("font-style"),fontVariant:b.css("font-variant"),fontWeight:b.css("font-weight"),wordSpacing:b.css("word-spacing"),letterSpacing:b.css("letter-spacing"),textIndent:b.css("text-indent"),textRendering:b.css("text-rendering"),textTransform:b.css("text-transform")}).insertAfter(b)}function f(a,b){return c.normalizeQuery(a)===c.normalizeQuery(b)}function g(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var h;return h={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},c.normalizeQuery=function(a){return b.toStr(a).replace(/^\s*/g,"").replace(/\s{2,}/g," ")},b.mixin(c.prototype,e,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.queryWhenFocused=this.query,this.trigger("focused")},_onKeydown:function(a){var b=h[a.which||a.keyCode];this._managePreventDefault(b,a),b&&this._shouldTrigger(b,a)&&this.trigger(b+"Keyed",a)},_onInput:function(){this._setQuery(this.getInputValue()),this.clearHintIfInvalid(),this._checkLanguageDirection()},_managePreventDefault:function(a,b){var c;switch(a){case"up":case"down":c=!g(b);break;default:c=!1}c&&b.preventDefault()},_shouldTrigger:function(a,b){var c;switch(a){case"tab":c=!g(b);break;default:c=!0}return c},_checkLanguageDirection:function(){var a=(this.$input.css("direction")||"ltr").toLowerCase();this.dir!==a&&(this.dir=a,this.$hint.attr("dir",a),this.trigger("langDirChanged",a))},_setQuery:function(a,b){var c,d;c=f(a,this.query),d=!!c&&this.query.length!==a.length,this.query=a,b||c?!b&&d&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},bind:function(){var a,c,d,e,f=this;return a=b.bind(this._onBlur,this),c=b.bind(this._onFocus,this),d=b.bind(this._onKeydown,this),e=b.bind(this._onInput,this),this.$input.on("blur.tt",a).on("focus.tt",c).on("keydown.tt",d),!b.isMsie()||b.isMsie()>9?this.$input.on("input.tt",e):this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){h[a.which||a.keyCode]||b.defer(b.bind(f._onInput,f,a))}),this},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getLangDir:function(){return this.dir},getQuery:function(){return this.query||""},setQuery:function(a,b){this.setInputValue(a),this._setQuery(a,b)},hasQueryChangedSinceLastFocus:function(){return this.query!==this.queryWhenFocused},getInputValue:function(){return this.$input.val()},setInputValue:function(a){this.$input.val(a),this.clearHintIfInvalid(),this._checkLanguageDirection()},resetInputValue:function(){this.setInputValue(this.query)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a,b,c,d;a=this.getInputValue(),b=this.getHint(),c=a!==b&&0===b.indexOf(a),d=""!==a&&c&&!this.hasOverflow(),!d&&this.clearHint()},hasFocus:function(){return this.$input.is(":focus")},hasOverflow:function(){var a=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,c,d;return a=this.$input.val().length,c=this.$input[0].selectionStart,b.isNumber(c)?c===a:!document.selection||(d=document.selection.createRange(),d.moveStart("character",-a),a===d.text.length)},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$overflowHelper.remove(),this.$hint=this.$input=this.$overflowHelper=a("<div>")}}),c}(),h=function(){"use strict";function c(c,e){c=c||{},c.templates=c.templates||{},c.templates.notFound=c.templates.notFound||c.templates.empty,c.source||a.error("missing source"),c.node||a.error("missing node"),c.name&&!h(c.name)&&a.error("invalid dataset name: "+c.name),e.mixin(this),this.highlight=!!c.highlight,this.name=c.name||j(),this.limit=c.limit||5,this.displayFn=d(c.display||c.displayKey),this.templates=g(c.templates,this.displayFn),this.source=c.source.__ttAdapter?c.source.__ttAdapter():c.source,this.async=b.isUndefined(c.async)?this.source.length>2:!!c.async,this._resetLastSuggestion(),this.$el=a(c.node).addClass(this.classes.dataset).addClass(this.classes.dataset+"-"+this.name)}function d(a){function c(b){return b[a]}return a=a||b.stringify,b.isFunction(a)?a:c}function g(c,d){function e(b){return a("<div>").text(d(b))}return{notFound:c.notFound&&b.templatify(c.notFound),pending:c.pending&&b.templatify(c.pending),header:c.header&&b.templatify(c.header),footer:c.footer&&b.templatify(c.footer),suggestion:c.suggestion||e}}function h(a){return/^[_a-zA-Z0-9-]+$/.test(a)}var i,j;return i={val:"tt-selectable-display",obj:"tt-selectable-object"},j=b.getIdGenerator(),c.extractData=function(b){var c=a(b);return c.data(i.obj)?{val:c.data(i.val)||"",obj:c.data(i.obj)||null}:null},b.mixin(c.prototype,e,{_overwrite:function(a,b){b=b||[],b.length?this._renderSuggestions(a,b):this.async&&this.templates.pending?this._renderPending(a):!this.async&&this.templates.notFound?this._renderNotFound(a):this._empty(),this.trigger("rendered",this.name,b,!1)},_append:function(a,b){b=b||[],b.length&&this.$lastSuggestion.length?this._appendSuggestions(a,b):b.length?this._renderSuggestions(a,b):!this.$lastSuggestion.length&&this.templates.notFound&&this._renderNotFound(a),this.trigger("rendered",this.name,b,!0)},_renderSuggestions:function(a,b){var c;c=this._getSuggestionsFragment(a,b),this.$lastSuggestion=c.children().last(),this.$el.html(c).prepend(this._getHeader(a,b)).append(this._getFooter(a,b))},_appendSuggestions:function(a,b){var c,d;c=this._getSuggestionsFragment(a,b),d=c.children().last(),this.$lastSuggestion.after(c),this.$lastSuggestion=d},_renderPending:function(a){var b=this.templates.pending;this._resetLastSuggestion(),b&&this.$el.html(b({query:a,dataset:this.name}))},_renderNotFound:function(a){var b=this.templates.notFound;this._resetLastSuggestion(),b&&this.$el.html(b({query:a,dataset:this.name}))},_empty:function(){this.$el.empty(),this._resetLastSuggestion()},_getSuggestionsFragment:function(c,d){var e,g=this;return e=document.createDocumentFragment(),b.each(d,function(b){var d,f;f=g._injectQuery(c,b),d=a(g.templates.suggestion(f)).data(i.obj,b).data(i.val,g.displayFn(b)).addClass(g.classes.suggestion+" "+g.classes.selectable),e.appendChild(d[0])}),this.highlight&&f({className:this.classes.highlight,node:e,pattern:c}),a(e)},_getFooter:function(a,b){return this.templates.footer?this.templates.footer({query:a,suggestions:b,dataset:this.name}):null},_getHeader:function(a,b){return this.templates.header?this.templates.header({query:a,suggestions:b,dataset:this.name}):null},_resetLastSuggestion:function(){this.$lastSuggestion=a()},_injectQuery:function(a,c){return b.isObject(c)?b.mixin({_query:a},c):c},update:function(b){function c(a){g||(g=!0,a=(a||[]).slice(0,e.limit),h=a.length,e._overwrite(b,a),h<e.limit&&e.async&&e.trigger("asyncRequested",b))}function d(c){c=c||[],!f&&h<e.limit&&(e.cancel=a.noop,e._append(b,c.slice(0,e.limit-h)),e.async&&e.trigger("asyncReceived",b))}var e=this,f=!1,g=!1,h=0;this.cancel(),this.cancel=function(){f=!0,e.cancel=a.noop,e.async&&e.trigger("asyncCanceled",b)},this.source(b,c,d),!g&&c([])},cancel:a.noop,clear:function(){this._empty(),this.cancel(),this.trigger("cleared")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=a("<div>")}}),c}(),i=function(){"use strict";function c(c,d){function e(b){var c=f.$node.find(b.node).first();return b.node=c.length?c:a("<div>").appendTo(f.$node),new h(b,d)}var f=this;c=c||{},c.node||a.error("node is required"),d.mixin(this),this.$node=a(c.node),this.query=null,this.datasets=b.map(c.datasets,e)}return b.mixin(c.prototype,e,{_onSelectableClick:function(b){this.trigger("selectableClicked",a(b.currentTarget))},_onRendered:function(a,b,c,d){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetRendered",b,c,d)},_onCleared:function(){this.$node.toggleClass(this.classes.empty,this._allDatasetsEmpty()),this.trigger("datasetCleared")},_propagate:function(){this.trigger.apply(this,arguments)},_allDatasetsEmpty:function(){function a(a){return a.isEmpty()}return b.every(this.datasets,a)},_getSelectables:function(){return this.$node.find(this.selectors.selectable)},_removeCursor:function(){var a=this.getActiveSelectable();a&&a.removeClass(this.classes.cursor)},_ensureVisible:function(a){var b,c,d,e;b=a.position().top,c=b+a.outerHeight(!0),d=this.$node.scrollTop(),e=this.$node.height()+parseInt(this.$node.css("paddingTop"),10)+parseInt(this.$node.css("paddingBottom"),10),0>b?this.$node.scrollTop(d+b):c>e&&this.$node.scrollTop(d+(c-e))},bind:function(){var a,c=this;return a=b.bind(this._onSelectableClick,this),this.$node.on("click.tt",this.selectors.selectable,a),b.each(this.datasets,function(a){a.onSync("asyncRequested",c._propagate,c).onSync("asyncCanceled",c._propagate,c).onSync("asyncReceived",c._propagate,c).onSync("rendered",c._onRendered,c).onSync("cleared",c._onCleared,c)}),this},isOpen:function(){return this.$node.hasClass(this.classes.open)},open:function(){this.$node.addClass(this.classes.open)},close:function(){this.$node.removeClass(this.classes.open),this._removeCursor()},setLanguageDirection:function(a){this.$node.attr("dir",a)},selectableRelativeToCursor:function(a){var b,c,d,e;return c=this.getActiveSelectable(),b=this._getSelectables(),d=c?b.index(c):-1,e=d+a,e=(e+1)%(b.length+1)-1,e=-1>e?b.length-1:e,-1===e?null:b.eq(e)},setCursor:function(a){this._removeCursor(),(a=a&&a.first())&&(a.addClass(this.classes.cursor),this._ensureVisible(a))},getSelectableData:function(a){return a&&a.length?h.extractData(a):null},getActiveSelectable:function(){var a=this._getSelectables().filter(this.selectors.cursor).first();return a.length?a:null},getTopSelectable:function(){var a=this._getSelectables().first();return a.length?a:null},update:function(a){function c(b){b.update(a)}var d=a!==this.query;return d&&(this.query=a,b.each(this.datasets,c)),d},empty:function(){function a(a){a.clear()}b.each(this.datasets,a),this.query=null,this.$node.addClass(this.classes.empty)},destroy:function(){function c(a){a.destroy()}this.$node.off(".tt"),this.$node=a("<div>"),b.each(this.datasets,c)}}),c}(),j=function(){"use strict";function a(){i.apply(this,[].slice.call(arguments,0))}var c=i.prototype;return b.mixin(a.prototype,i.prototype,{open:function(){return!this._allDatasetsEmpty()&&this._show(),c.open.apply(this,[].slice.call(arguments,0))},close:function(){return this._hide(),c.close.apply(this,[].slice.call(arguments,0))},_onRendered:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),c._onRendered.apply(this,[].slice.call(arguments,0))},_onCleared:function(){return this._allDatasetsEmpty()?this._hide():this.isOpen()&&this._show(),c._onCleared.apply(this,[].slice.call(arguments,0))},setLanguageDirection:function(a){return this.$node.css("ltr"===a?this.css.ltr:this.css.rtl),c.setLanguageDirection.apply(this,[].slice.call(arguments,0))},_hide:function(){this.$node.hide()},_show:function(){this.$node.css("display","block")}}),a}(),k=function(){"use strict";function c(c,e){var f,g,h,i,j,k,l,m,n,o,p;c=c||{},c.input||a.error("missing input"),c.menu||a.error("missing menu"),c.eventBus||a.error("missing event bus"),e.mixin(this),this.eventBus=c.eventBus,this.minLength=b.isNumber(c.minLength)?c.minLength:1,this.input=c.input,this.menu=c.menu,this.enabled=!0,this.active=!1,this.input.hasFocus()&&this.activate(),this.dir=this.input.getLangDir(),this._hacks(),this.menu.bind().onSync("selectableClicked",this._onSelectableClicked,this).onSync("asyncRequested",this._onAsyncRequested,this).onSync("asyncCanceled",this._onAsyncCanceled,this).onSync("asyncReceived",this._onAsyncReceived,this).onSync("datasetRendered",this._onDatasetRendered,this).onSync("datasetCleared",this._onDatasetCleared,this),f=d(this,"activate","open","_onFocused"),g=d(this,"deactivate","_onBlurred"),h=d(this,"isActive","isOpen","_onEnterKeyed"),i=d(this,"isActive","isOpen","_onTabKeyed"),j=d(this,"isActive","_onEscKeyed"),k=d(this,"isActive","open","_onUpKeyed"),l=d(this,"isActive","open","_onDownKeyed"),m=d(this,"isActive","isOpen","_onLeftKeyed"),n=d(this,"isActive","isOpen","_onRightKeyed"),o=d(this,"_openIfActive","_onQueryChanged"),p=d(this,"_openIfActive","_onWhitespaceChanged"),this.input.bind().onSync("focused",f,this).onSync("blurred",g,this).onSync("enterKeyed",h,this).onSync("tabKeyed",i,this).onSync("escKeyed",j,this).onSync("upKeyed",k,this).onSync("downKeyed",l,this).onSync("leftKeyed",m,this).onSync("rightKeyed",n,this).onSync("queryChanged",o,this).onSync("whitespaceChanged",p,this).onSync("langDirChanged",this._onLangDirChanged,this)}function d(a){var c=[].slice.call(arguments,1);return function(){var d=[].slice.call(arguments);b.each(c,function(b){return a[b].apply(a,d)})}}return b.mixin(c.prototype,{_hacks:function(){var c,d;c=this.input.$input||a("<div>"),d=this.menu.$node||a("<div>"),c.on("blur.tt",function(a){var e,f,g;e=document.activeElement,f=d.is(e),g=d.has(e).length>0,b.isMsie()&&(f||g)&&(a.preventDefault(),a.stopImmediatePropagation(),b.defer(function(){c.focus()}))}),d.on("mousedown.tt",function(a){a.preventDefault()})},_onSelectableClicked:function(a,b){this.select(b)},_onDatasetCleared:function(){this._updateHint()},_onDatasetRendered:function(a,b,c,d){this._updateHint(),this.eventBus.trigger("render",c,d,b)},_onAsyncRequested:function(a,b,c){this.eventBus.trigger("asyncrequest",c,b)},_onAsyncCanceled:function(a,b,c){this.eventBus.trigger("asynccancel",c,b)},_onAsyncReceived:function(a,b,c){this.eventBus.trigger("asyncreceive",c,b)},_onFocused:function(){this._minLengthMet()&&this.menu.update(this.input.getQuery())},_onBlurred:function(){this.input.hasQueryChangedSinceLastFocus()&&this.eventBus.trigger("change",this.input.getQuery())},_onEnterKeyed:function(a,b){var c;(c=this.menu.getActiveSelectable())&&this.select(c)&&b.preventDefault()},_onTabKeyed:function(a,b){var c;(c=this.menu.getActiveSelectable())?this.select(c)&&b.preventDefault():(c=this.menu.getTopSelectable())&&this.autocomplete(c)&&b.preventDefault()},_onEscKeyed:function(){this.close()},_onUpKeyed:function(){this.moveCursor(-1)},_onDownKeyed:function(){this.moveCursor(1)},_onLeftKeyed:function(){"rtl"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onRightKeyed:function(){"ltr"===this.dir&&this.input.isCursorAtEnd()&&this.autocomplete(this.menu.getTopSelectable())},_onQueryChanged:function(a,b){this._minLengthMet(b)?this.menu.update(b):this.menu.empty()},_onWhitespaceChanged:function(){this._updateHint()},_onLangDirChanged:function(a,b){this.dir!==b&&(this.dir=b,this.menu.setLanguageDirection(b))},_openIfActive:function(){this.isActive()&&this.open()},_minLengthMet:function(a){return a=b.isString(a)?a:this.input.getQuery()||"",a.length>=this.minLength},_updateHint:function(){var a,c,d,e,f,h,i;a=this.menu.getTopSelectable(),c=this.menu.getSelectableData(a),d=this.input.getInputValue(),!c||b.isBlankString(d)||this.input.hasOverflow()?this.input.clearHint():(e=g.normalizeQuery(d),f=b.escapeRegExChars(e),h=new RegExp("^(?:"+f+")(.+$)","i"),i=h.exec(c.val),i&&this.input.setHint(d+i[1]))},isEnabled:function(){return this.enabled},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},isActive:function(){return this.active},activate:function(){return!!this.isActive()||!(!this.isEnabled()||this.eventBus.before("active"))&&(this.active=!0,this.eventBus.trigger("active"),!0)},deactivate:function(){return!this.isActive()||!this.eventBus.before("idle")&&(this.active=!1,this.close(),this.eventBus.trigger("idle"),!0)},isOpen:function(){return this.menu.isOpen()},open:function(){return this.isOpen()||this.eventBus.before("open")||(this.menu.open(),this._updateHint(),this.eventBus.trigger("open")),this.isOpen()},close:function(){return this.isOpen()&&!this.eventBus.before("close")&&(this.menu.close(),this.input.clearHint(),this.input.resetInputValue(),this.eventBus.trigger("close")),!this.isOpen()},setVal:function(a){this.input.setQuery(b.toStr(a))},getVal:function(){return this.input.getQuery()},select:function(a){var b=this.menu.getSelectableData(a);return!(!b||this.eventBus.before("select",b.obj))&&(this.input.setQuery(b.val,!0),this.eventBus.trigger("select",b.obj),this.close(),!0)},autocomplete:function(a){var b,c,d;return b=this.input.getQuery(),c=this.menu.getSelectableData(a),d=c&&b!==c.val,!(!d||this.eventBus.before("autocomplete",c.obj))&&(this.input.setQuery(c.val),this.eventBus.trigger("autocomplete",c.obj),!0)},moveCursor:function(a){var b,c,d,e,f;return b=this.input.getQuery(),c=this.menu.selectableRelativeToCursor(a),d=this.menu.getSelectableData(c),e=d?d.obj:null,f=this._minLengthMet()&&this.menu.update(b),!f&&!this.eventBus.before("cursorchange",e)&&(this.menu.setCursor(c),d?this.input.setInputValue(d.val):(this.input.resetInputValue(),this._updateHint()),this.eventBus.trigger("cursorchange",e),!0)},destroy:function(){this.input.destroy(),this.menu.destroy()}}),c}();!function(){"use strict";function e(b,c){b.each(function(){var b,d=a(this);(b=d.data(p.typeahead))&&c(b,d)})}function f(a,b){return a.clone().addClass(b.classes.hint).removeData().css(b.css.hint).css(l(a)).prop("readonly",!0).removeAttr("id name placeholder required").attr({autocomplete:"off",spellcheck:"false",tabindex:-1})}function h(a,b){a.data(p.attrs,{dir:a.attr("dir"),autocomplete:a.attr("autocomplete"),spellcheck:a.attr("spellcheck"),style:a.attr("style")}),a.addClass(b.classes.input).attr({autocomplete:"off",spellcheck:!1});try{!a.attr("dir")&&a.attr("dir","auto")}catch(a){}return a}function l(a){return{backgroundAttachment:a.css("background-attachment"),backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),backgroundRepeat:a.css("background-repeat"),backgroundSize:a.css("background-size")}}function m(a){var c,d;c=a.data(p.www),d=a.parent().filter(c.selectors.wrapper),b.each(a.data(p.attrs),function(c,d){b.isUndefined(c)?a.removeAttr(d):a.attr(d,c)}),a.removeData(p.typeahead).removeData(p.www).removeData(p.attr).removeClass(c.classes.input),d.length&&(a.detach().insertAfter(d),d.remove())}function n(c){var d,e;return d=b.isJQuery(c)||b.isElement(c),e=d?a(c).first():[],e.length?e:null}var o,p,q;o=a.fn.typeahead,p={www:"tt-www",attrs:"tt-attrs",typeahead:"tt-typeahead"},q={initialize:function(e,l){function m(){var c,m,q,r,s,t,u,v,w,x,y;b.each(l,function(a){a.highlight=!!e.highlight}),c=a(this),m=a(o.html.wrapper),q=n(e.hint),r=n(e.menu),s=e.hint!==!1&&!q,t=e.menu!==!1&&!r,s&&(q=f(c,o)),t&&(r=a(o.html.menu).css(o.css.menu)),q&&q.val(""),c=h(c,o),(s||t)&&(m.css(o.css.wrapper),c.css(s?o.css.input:o.css.inputWithNoHint),c.wrap(m).parent().prepend(s?q:null).append(t?r:null)),y=t?j:i,u=new d({el:c}),v=new g({hint:q,input:c},o),w=new y({node:r,datasets:l},o),x=new k({input:v,menu:w,eventBus:u,minLength:e.minLength},o),c.data(p.www,o),c.data(p.typeahead,x)}var o;return l=b.isArray(l)?l:[].slice.call(arguments,1),e=e||{},o=c(e.classNames),this.each(m)},isEnabled:function(){var a;return e(this.first(),function(b){a=b.isEnabled()}),a},enable:function(){return e(this,function(a){a.enable()}),this},disable:function(){return e(this,function(a){a.disable()}),this},isActive:function(){var a;return e(this.first(),function(b){a=b.isActive()}),a},activate:function(){return e(this,function(a){a.activate()}),this},deactivate:function(){return e(this,function(a){a.deactivate()}),this},isOpen:function(){var a;return e(this.first(),function(b){a=b.isOpen()}),a},open:function(){return e(this,function(a){a.open()}),this},close:function(){return e(this,function(a){a.close()}),this},select:function(b){var c=!1,d=a(b);return e(this.first(),function(a){c=a.select(d)}),c},autocomplete:function(b){var c=!1,d=a(b);return e(this.first(),function(a){c=a.autocomplete(d)}),c},moveCursor:function(a){var b=!1;return e(this.first(),function(c){b=c.moveCursor(a)}),b},val:function(a){var b;return arguments.length?(e(this,function(b){b.setVal(a)}),this):(e(this.first(),function(a){b=a.getVal()}),b)},destroy:function(){return e(this,function(a,b){m(b),a.destroy()}),this}},a.fn.typeahead=function(a){return q[a]?q[a].apply(this,[].slice.call(arguments,1)):q.initialize.apply(this,arguments)},a.fn.typeahead.noConflict=function(){return a.fn.typeahead=o,this}}()});var number,previousId;!function(a){a.fn.serializeObject=function(){"use strict";var b={},c=function(c,d){var e=d.name,f=b[e];"undefined"!=typeof f&&null!==f?a.isArray(f)?f.push(d.value):b[e]=[f,d.value]:b[e]=d.value};return a.each(this.serializeArray(),c),b}}(window.jQuery);var UIManager=Fiber.extend(function(){function a(){$(".loading, .jqgrid-overlay").show()}function b(){$(".loading, .jqgrid-overlay").hide()}function c(){var a=$(".customer-dropdown"),b=a.val(),c=a.attr("data-selected-id"),d=$(".customer-is-not-dropdown"),e=d.val(),f=d.attr("data-selected-id");return c||""==b?{customerId:c,customerText:b,customerIsNotId:f,customerIsNotText:e}:(alert("Selected customer is not valid!"),a.focus(),!1)}function d(a){a.data("datepicker_created")||(console.log("register date picker control."),a.data("datepicker_created",!0),a.datepicker({format:"m/d/yyyy",clearBtn:!0,autoclose:!0}),a.is(".ship-date")?a.on("changeDate",g):a.is(".cancel-date")&&a.on("changeDate",f))}function e(a){var b=$(this);return b.find("input").is(":disabled")?(a.cancelBubble=!0,void a.preventDefault()):(d(b),console.log("show date picker."),b.datepicker("show"),a.cancelBubble=!0,void a.preventDefault())}function f(a){try{console.log("onCancelDateChanged()",arguments);var b=$(a.currentTarget),c=b.datepicker("getDate"),d=c?c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear():"",e=b.attr("data-orig-value"),f=b.parents("tr:first"),g="true"==f.attr("data-is-mainline");console.log("val: ",d),console.log("origValue: ",e),console.log("isMainline: ",g),d===e?f.removeClass("modified-cancel-date"):f.addClass("modified-cancel-date")}catch(a){console.error("ERROR","Error during main onShipDateChanged",a.toString())}}function gg(a) {var $this = $(this);var oldValue = $this.attr('data-orig-value');var qtyVal = $this.val();$this.attr('data-new-value', qtyVal);if (qtyVal === oldValue) {$(this).parents('tr:first').removeClass('modified-item');}else { $(this).parents('tr:first').addClass('modified-item');}}function g(a){try{console.log("onShipDateChanged()",arguments);var b=$(a.currentTarget),c=b.datepicker("getDate"),d=c?c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear():"",e=b.attr("data-orig-value"),f=b.parents("tr:first"),g="true"==f.attr("data-is-mainline");if(console.log("val: ",d),console.log("origValue: ",e),console.log("isMainline: ",g),d===e?f.removeClass("modified-ship-date"):f.addClass("modified-ship-date"),
g===!0){var h=f.attr("data-salesorder-id"),i=f.parent().find('tr[data-salesorder-id="'+h+'"]').not(f);i.find(".input-group.ship-date input:not(:disabled)").parent().each(function(a,b){console.log("each: ",a,b);var c=$(this),e=c.parents("tr:first"),f=d,g=c.attr("data-orig-value");c.datepicker("setDate",f),f===g?e.removeClass("modified-ship-date"):e.addClass("modified-ship-date")})}}catch(a){console.error("ERROR","Error during main onShipDateChanged",a.toString())}}function h(a){try{console.log("onCheckChanged()",arguments);var b=$(a.target),c=b.is(":checked"),d=b.parent().parent(),e="true"===d.attr("data-is-mainline"),f=d.attr("data-salesorder-id"),g=null;if(e===!0){var h=d.parent().find('tr[data-salesorder-id="'+f+'"]');g=h.find(".item-picker, .input-group.date input");var i=h.find("input.close-checkbox").not(b),j=h.find("input.print-checkbox,input.approve-checkbox,input.email-checkbox"),k=h.find("select.closed-reason-dropdown");i.prop("checked",c),c===!0?(i.attr("disabled","disabled"),k.attr("required","required"),j.attr("disabled","disabled"),j.prop("checked",!1)):(i.removeAttr("disabled"),k.removeAttr("required"),j.removeAttr("disabled"))}else g=d.find(".item-picker, .input-group.date input");if(c===!0){g.filter(":not(:disabled)").attr("disabled","disabled").attr("data-custom-disabled","true").not(".item-picker").parent().each(function(){$(this).datepicker("remove")})}else g.filter('[data-custom-disabled="true"]').removeAttr("disabled").removeAttr("data-custom-disabled")}catch(a){console.error("ERROR","Error during main onCheckChanged",a.toString())}}function i(){var a=$(this).find(".swap-item-text");a.removeAttr("data-selected-id"),a.removeAttr("data-selected-text"),a.typeahead("val","")}function j(){var a=$(this),b=a.find(".input-group.date"),c=a.find(".form-horizontal"),d=a.find(".alert-success");b.datepicker("clearDates"),c.show(),d.hide()}function k(a){a.preventDefault();var b=$(".panel-body-wrapper").attr("aria-expanded");"true"==b||void 0==b||null==b?$("#filter_panel_id").text("+ Filters"):"false"==b&&$("#filter_panel_id").text("- Filters"),$(".panel-body-wrapper").collapse("toggle")}function l(a){console.log("onCustomerFocusOut","asdsa");var b=$("#customer").val();""!=b&&void 0!=b?$("#customer_is_not").attr("disabled","disabled"):$("#customer_is_not").removeAttr("disabled")}function m(a){console.log("onCustomerIsNotFocusOut","asdsa");var b=$("#customer_is_not").val();""!=b&&void 0!=b?$("#customer").attr("disabled","disabled"):$("#customer").removeAttr("disabled")}function n(){s.saveCurrentState(_currentPage)}function o(a,b,c){setTimeout(function(){q.getItems({query:a},function(a){try{c(a.data)}catch(a){console.error("ERROR","Error during async binding.",a.toString())}})},10)}function p(a){var b=$(this);if(!b.data("itempicker_created")){console.log("bind item picker control.");var c={hint:!1,minLength:3,highlight:!0},d={name:"Items",limit:500,display:function(a){return a.name},source:o,templates:{empty:['<div class="empty-message">',"unable to find any items that match the current query","</div>"].join("\n")}};b.typeahead(c,d),b.bind("typeahead:change",function(){console.log("typeahead:change: ",arguments);var a=$(this),b=(a.attr("data-selected-id"),a.attr("data-selected-text")),c=a.val(),d=b==c;console.log("selectedText: ",b),console.log("val: ",c),console.log("selectedText == val: ",b==c),0==d&&(a.typeahead("val",b),alert("Selected item does not exist."))}).bind("typeahead:select",function(a,b,c){console.log("typeahead:select: ",arguments);var d=$(this),e=d.parents("tr:first");if(d.attr("data-selected-id",b.id),d.attr("data-selected-text",b.name),d.is(".item-picker")===!0){var f=d.attr("data-orig-value");f===b.name?e.removeClass("modified-item"):e.addClass("modified-item")}}),b.data("itempicker_created",!0),b.focus()}}var q=null,r=null,s=null,t={$grid:null,data:null,addData:function(a,b){},preselectFilters:function(){},updatePagination:function(){console.log("updatePagination: ",arguments),_currentPage<=1?$("#btn_previous").attr("disabled","disabled"):$("#btn_previous").removeAttr("disabled");var a=$(".pagination-label");if(!this.data||this.data.length<=0)a.empty();else{var b="Page "+_currentPage;a.html(b)}},createItemPicker:function(a,b,c){function d(a){return a.replace(/"/g,"&quot;")}if(c.item){var e=c.is_substitute_for&&c.is_substitute_for.quantityavailable>0||c.substitute&&!(c.quantity_committed>0),f=c.item&&c.item.value,g=parseInt(c.quantity_packed)>0?' disabled="disabled" ':"",h='<input type="text" class="form-control input-sm item-picker '+(e?"flash-red":"")+'" '+g+'data-selected-id="'+f+'" data-selected-text="'+a+'" data-orig-value="'+a+'" value="'+a+'" data-toggle="popover"'+(e?"data-hover="+c.substitute.text:"")+'" data-placement="bottom"/>';return h}var i=c.name&&c.name.value||"",j="<div>"+(c.custbody_ptcmnt?c.custbody_ptcmnt:"")+"</div><br /><div>"+(c.shipmethod?c.shipmethod.text:"")+"</div>";return'<a href="javascript:;" class="customer-name-anchor" data-content="'+d(j)+'" data-toggle="popover" data-placement="bottom" id="custname_anchor_'+i+'">'+c.name.text+"</a>"},createItemDescriptionLink:function(a,b,c){if(c.item){var d=c.item&&c.item.value||"";return'<a href="javascript:;" class="itemdesc_anchor" id="itemdesc_anchor_'+d+'"  data-selected-text="'+c.item.text+'" data-toggle="popover" data-placement="bottom" >'+a+"</a>"}return a},createCustomerNameLink:function(a,b,c){var d=c.name&&c.name.value||"";return'<a href="javascript:;" id="custname_anchor_'+d+'" onmouseout="hideCustomerQuickView('+d+')" onmouseover="showCustomerQuickView('+d+", "+d+');" >'+a+"</a>"},createStatusAndCustomerNameLink:function(a,b,c){var d=c.name.text,e=c.name&&c.name.value||"";return"<span>"+a+'</span> / <a href="javascript:;" id="custname_anchor_'+e+'" onmouseout="hideCustomerQuickView('+e+')" onclick="showCustomerQuickView('+e+", "+e+');" >'+d+"</a>"},createItemSwapInt: function(a, b, c){if (c.item) { return '<input type="text" class="form-control input-sm swap-qty" data-new-value="" data-orig-value="' + c.open_quantity + '" value="' + c.open_quantity + '" />'} return "" },createPrintCheckbox:function(a,b,c){return c.item?"":'<input type="checkbox" class="print-checkbox" data-salesorder-id="'+c.id+'" />'},createApproveCheckbox:function(a,b,c){return c.item?"":'<input type="checkbox" class="approve-checkbox" data-salesorder-id="'+c.id+'" />'},createEmailCheckbox:function(a,b,c){return c.item?"":'<input type="checkbox" class="email-checkbox" data-salesorder-id="'+c.id+'" />'},createSalesOrderLink:function(a,b,c){number=c.number?c.number:c.id;var d="/app/accounting/transactions/salesord.nl?id="+c.id;return'<a href="'+d+'" target="_blank" >'+number+"</a>"},createCloseCheckbox:function(a,b,c){var d=c.item&&c.item.text||"";return'<input type="checkbox" class="close-checkbox" data-salesorder-id="'+c.id+'"   data-item-id="'+d+'" />'},createShipDatePicker:function(a,b,c){return'<div class="input-group input-group-sm date ship-date" data-orig-value="'+a+'"><input type="text" class="form-control" value="'+a+'" /><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span></div>'},createCancelDatePicker:function(a,b,c){return c.item?"":'<div class="input-group input-group-sm date cancel-date" data-orig-value="'+a+'"><input type="text" class="form-control" value="'+a+'" /><span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span></div>'},createClosedReasonPicker:function(a,b,c){return c.item?"":'<select class="form-control closed-reason-dropdown" data-closeso-id="' + c.id + '" id="' + c.id + '" name="closed-reason"> <option value="" selected="selected">None</option><option value="3">Backorderd</option><option value="1">Customer Request</option><option value="4">Missed Cancelled Date</option><option value="5">Non Stocked Item</option><option value="2">Order Below Min</option><option value="6">Back Order Below Minimum</option><option value="7">Sample Order not shipped</option></select>'},afterGridComplete:function(){s.reloadCurrentState(_currentPage)},fetchGridData:function(d){console.log("fetchGridData()",arguments);var e=StopWatch.start("fetchGridData()"),f=this,g=c();if(g!==!1){a();var h=$(".form-horizontal :input").serializeObject();g.customerId&&(h.customer=g.customerId),g.customerIsNotId&&(h.customer_is_not=g.customerIsNotId),_currentPage=d.page||1;var i=_currentPage-1,j=StopWatch.start("getSalesOrders()");q.getSalesOrders(h,i,function(a){console.log("fetchGridData() // ajax complete: ",arguments),j.stop(),f.data=a,setTimeout($.proxy(function(){this.addData(this.data,_currentPage),this.updatePagination(),b(),e.stop()},f),10)})}},bindTeamsDropdown:function(){console.log("bindTeamsDropdown();");$("#league option:selected").val();$("#team").find("option").remove()},bindDropdowns:function(){q.getPartners(function(a){setTimeout(function(){var b=document.getElementById("partner"),c=document.getElementById("partner_is_not");200===a.status_code&&($.each(a.data,function(a,c){var d="T"===c.isperson?c.firstname+" "+c.lastname:c.companyname;b.options[b.options.length]=new Option(d,c.id)}),$.each(a.data,function(a,b){var d="T"===b.isperson?b.firstname+" "+b.lastname:b.companyname;c.options[c.options.length]=new Option(d,b.id)}))},10)}),q.getProductTypes(function(a){setTimeout(function(){var b=document.getElementById("product_type");200===a.status_code&&$.each(a.data,function(a,c){var d=c.name;b.options[b.options.length]=new Option(d,c.id)})},10)}),q.getLocations(function(a){setTimeout(function(){var b=document.getElementById("warehouse");200===a.status_code&&$.each(a.data,function(a,c){b.options[b.options.length]=new Option(c.name,c.id)})},10)}),q.getLeagues(function(a){setTimeout(function(){var b=document.getElementById("league");200===a.status_code&&$.each(a.data,function(a,c){b.options[b.options.length]=new Option(c.name,c.id)})},10)}),q.getTeams(null,function(a){setTimeout(function(){var b=document.getElementById("team");200===a.status_code&&($.each(a.data,function(a,c){b.options[b.options.length]=new Option(c.name,c.id)}),q.loadDefaultSettings())},10)});var a=$(".customer-dropdown"),b=$(".customer-is-not-dropdown"),c={hint:!1,minLength:3,highlight:!0},d={name:"customers",limit:500,display:function(a){var b="T"===a.isperson,c=b?a.firstname+" "+a.lastname:a.companyname;return a.entityid+" "+c},source:function(a,b,c){setTimeout(function(){q.getCustomers({query:a},function(a){try{c(a.data)}catch(a){console.error("ERROR","Error during async binding.",a.toString())}})},10)},templates:{empty:['<div class="empty-message">',"unable to find any customers that match the current query","</div>"].join("\n")}};a.typeahead(c,d),a.bind("typeahead:change",function(a,b){console.log("typeahead:change: ",arguments);var c=$(this),d=(c.attr("data-selected-id"),c.attr("data-selected-text")),e=c.attr("data-selected-entityid"),f=e+" "+d,g=f==b;console.log("text: ",f),console.log("val: ",b),console.log("text == val: ",f==b),0==g&&(c.attr("data-selected-id",""),c.attr("data-selected-text",""),c.attr("data-selected-entityid",""))}).bind("typeahead:select",function(a,b){console.log("typeahead:select: ",arguments);var c="T"==b.isperson?b.firstname+" "+b.lastname:b.companyname,d=$(this);d.attr("data-selected-id",b.id),d.attr("data-selected-entityid",b.entityid),d.attr("data-selected-text",c)}),b.typeahead(c,d),b.bind("typeahead:change",function(a,b){console.log("typeahead1:change: ",arguments);var c=$(this),d=(c.attr("data-selected-id"),c.attr("data-selected-text")),e=c.attr("data-selected-entityid"),f=e+" "+d,g=f==b;console.log("text: ",f),console.log("val: ",b),console.log("text == val: ",f==b),0==g&&(c.attr("data-selected-id",""),c.attr("data-selected-text",""),c.attr("data-selected-entityid",""))}).bind("typeahead:select",function(a,b){console.log("typeahead:select: ",arguments);var c="T"==b.isperson?b.firstname+" "+b.lastname:b.companyname,d=$(this);d.attr("data-selected-id",b.id),d.attr("data-selected-entityid",b.entityid),d.attr("data-selected-text",c)})},fetchPrevPageItems:function(a){var b=$("#btn_previous");s.saveCurrentState(_currentPage),_currentPage--,this.fetchGridData({page:_currentPage}),1==_currentPage&&b.attr("disabled","disabled"),b.blur(),a.preventDefault()},markAllPrintCheckboxes:function(a){this.$grid.find(".print-checkbox:not(:disabled)").prop("checked",!0),$(a.target).blur(),a.preventDefault()},unmarkAllPrintCheckboxes:function(a){this.$grid.find(".print-checkbox").prop("checked",!1),$(a.target).blur(),a.preventDefault()},swapShipDate:function(a){var b=$("#swapShipDateModal"),c=b.find(".swap-ship-date-text"),e=b.find(".form-horizontal"),f=b.find(".alert-success");e.hide(),f.show();var g=$('#shipdatechanger').val(),h=StopWatch.start('$this.datepicker("setDate", '+g+")"),i=this.$grid.find("tr"),j=i.filter('[data-is-mainline="true"]'),k=j.map(function(){return this.getAttribute("data-salesorder-id")}).toArray(),l=i.filter('[data-is-mainline="false"]'),m=l.map(function(){return this.getAttribute("data-salesorder-id")}).toArray();m=_.difference(m,k);var n=k.concat(m);setTimeout(function(){_.each(n,function(a){console.log("setting ship date on: "+a);var b=i.filter('[data-salesorder-id="'+a+'"]'),c=b.find(".input-group.ship-date");c.each(function(){var a=$(this);d(a),a.datepicker("setDate",g)})}),h.stop(),b.modal("hide")},50),$(a.target).blur(),a.preventDefault()},swapItem:function(a){var b=StopWatch.start("swapItem()"),c=$("#swapItemModal"),d=c.find(".swap-item-text"),e=this.$grid.find(".item-picker:not(:disabled)"),f={id:d.attr("data-selected-id"),name:d.attr("data-selected-text")};if(!f.id||!f.name)return void alert("Please select an item to swap.");var g=e;console.log("$selectedItemPickers: ",g),g.each(function(){var a=$(this);a.attr("data-selected-id",f.id),a.attr("data-selected-text",f.name),a.val(f.name);var b=a.parents("tr:first"),c=a.attr("data-orig-value");c===f.name?b.removeClass("modified-item"):b.addClass("modified-item")}),c.modal("hide"),$(a.target).blur(),a.preventDefault(),b.stop()},fetchNextPageItems:function(a){var b=$("#btn_next");$("#btn_previous").removeAttr("disabled"),s.saveCurrentState(_currentPage),_currentPage++,this.fetchGridData({page:_currentPage}),b.blur(),a.preventDefault()},onFilter:function(){s.clearState();var a=$("#btn_swap_item"),b=$("#item"),c=b.val().trim();c?a.removeAttr("disabled"):a.attr("disabled","disabled"),this.fetchGridData({page:1})},saveDefaultSettings:function(){var d=$(".form-horizontal :input").serializeObject(),e=c();if(e!==!1){e.customerId&&(d.customer=e.customerId,d.customer_text=e.customerText),e.customerIsNotId&&(d.customer_is_not=e.customerIsNotId,d.customer_is_not_text=e.customerIsNotText),a();var f=nlapiGetContext(),g=f.getName(),h=f.getUser(),i=nlapiSearchRecord("customrecord_ppt_default_settings",null,new nlobjSearchFilter("custrecord_userid",null,"is",h));if(i){var j=i[0].getId(),k=nlapiLoadRecord("customrecord_ppt_default_settings",j);k.setFieldValue("custrecord_settings",JSON.stringify(d)),nlapiSubmitRecord(k)}else{var l=nlapiCreateRecord("customrecord_ppt_default_settings");l.setFieldValue("custrecord_userid",h),l.setFieldValue("custrecord_settings",JSON.stringify(d)),l.setFieldValue("name",g+" Default Settings"),nlapiSubmitRecord(l)}b()}},onSubmit:function(){try{console.log("onSubmit()",arguments),s.saveCurrentState(_currentPage);var c=s.getAllData();if(c.checkbox.orders.length<=0&&c.checkbox.items.length<=0&&c.checkbox.prints.length<=0&&_.size(c.salesorders)<=0)return void alert("Please modify at least one sales order/item");console.log(c),$("#load_jqGrid").html("Submitting Changes..."),a(),q.submit(c,$.proxy(function(a){$("#load_jqGrid").html("Loading..."),b(),s.clearState(),$("#submitChangesSuccessModal").modal("show"),this.fetchGridData({page:1})},this))}catch(a){console.error("ERROR","Error during main onSubmit",a.toString())}},bindGrid:function(){},init:function(a){this.preselectFilters();$.jgrid.defaults.width=$("#main_form").innerWidth(),this.$grid=$("#jqGrid"),q=new DataManager(a),r=new TooltipManager(window),s=new StateManager(this.$grid,a),this.bindGrid(),this.bindDropdowns(),$(".filters .input-group.date, #swapShipDateModal .input-group.date").datepicker({format:"m/d/yyyy",clearBtn:!0,autoclose:!0}),this.$grid.on("click","tr .close-checkbox",h),this.$grid.on("change", ".swap-qty", gg),this.$grid.on("focusin click",".input-group.date",e),this.$grid.on("focusin",".item-picker",p),this.$grid.on("click",".itemdesc_anchor",function(){$el=$(this),$el.data("bs.popover")?$el.popover("toggle"):($('[data-toggle="popover"]').not($el).popover("hide"),o($el.attr("data-selected-text"),null,function(a){data=a[0],$el.popover({content:function(){return"<div>"+data.custitem_internalimagethumb+"</div><div>Available Qty: "+data.quantityavailable+"</div><div>On Order Qty: "+data.quantityonorder+"</div><div>Buildable Qty: "+data.custitem_buildableqty+"</div><div>Is Sub For: "+(data.custitem_is_substitute_for?data.custitem_is_substitute_for.text+" | "+(data.custitem_is_substitute_for.quantityavailable||0):"")+"</div><div>"+(data.custitem_internalimagethumb_sub||"<img src='https://system.netsuite.com/core/media/media.nl?id=2568267&c=3500213&h=6edd6cca8aa34506d669'>")+"</div><div>Substitute: "+(data.custitem_substitute?data.custitem_substitute.text:"")+"</div><div>Available Qty: "+(data.custitem_substitute.quantityavailable||0)+"</div><div>Buildable Qty: "+(data.custitem_substitute.buildablequantity||0)+"</div><div>Description: "+data.custitem_substitute.description+"</div>"},html:!0,trigger:"manual"}).popover("show")}))}),this.$grid.on("click",".customer-name-anchor",function(){$el=$(this),$('[data-toggle="popover"]').not($el).popover("hide"),$el.data("bs.popover")?$el.popover("toggle"):$el.popover({html:!0,trigger:"manual"}).popover("show")}),p.apply($(".swap-item-text")),$(window).on("beforeunload",n),$("#btn_previous").on("click",$.proxy(this.fetchPrevPageItems,this)),$("#btn_next").on("click",$.proxy(this.fetchNextPageItems,this)),$("#btn_mark_all").on("click",$.proxy(this.markAllPrintCheckboxes,this)),$("#btn_unmark_all").on("click",$.proxy(this.unmarkAllPrintCheckboxes,this)),$(".btn-apply-filters").on("click",$.proxy(this.onFilter,this)),$(".btn-submit").on("click",$.proxy(this.onSubmit,this)),$(".btn_swap_modal_ok").on("click",$.proxy(this.swapItem,this)),$(".btn_ship_date_modal_ok").on("click",$.proxy(this.swapShipDate,this)),$("#swapItemModal").on("hidden.bs.modal",i),$("#swapShipDateModal").on("hidden.bs.modal",j),$("#filter_panel_id").on("click",k),$("#customer").on("focusout",l),$("#customer_is_not").on("focusout",m),$(".save-default").on("click",$.proxy(this.saveDefaultSettings,this))}};return t}),OrderReviewUIManager=UIManager.extend(function(a){function b(a,b){a.className.indexOf(b)===-1&&(a.className+=" "+b)}function c(a,b,c){var d="";d=e[a]?e[a]:c;var f=parseInt(d)-parseInt(b);return e[a]=f,f}function d(a,b){var d="OrderReview_ItemsRunningTotal_"+(b-1),f="OrderReview_ItemsRunningTotal_"+b;e=$.jStorage.get(d)||{},console.log("itemsRunningTotal: ",e);for(var g=0;g<a.length;g++){var h=a[g];if(h.item){var i=parseInt(h.open_quantity)||0,j=parseInt(h.feed_number)||0,k=h.item&&h.item.text;c(k,i,j);h.cust_total_available_quantity=e[k]}}var l=1e3,m=60*l,n=60*m;return $.jStorage.set(f,e,{TTL:n}),console.log("itemsRunningTotal: ",e),a}var e={},f={onGridCompleteInner:function(){console.log("onGridCompleteInner()",arguments);var a=this,c=StopWatch.start("onGridComplete()"),d=$(".ui-jqgrid"),f=$(".ui-jqgrid-bdiv"),g=$(".empty-grid-message");try{if(f.scrollTop(0),!this.data||this.data.length<=0)return d.hide(),void g.show();g.hide(),d.show();for(var h=StopWatch.start("for ._data()"),i=0;i<this.data.length;i++){var j=this.data[i],k="row_"+j.guid,l=document.getElementById(k);if(l)if(l.setAttribute("data-is-mainline",!j.item),l.setAttribute("data-salesorder-id",j.id),l.setAttribute("data-line-id",j.line_id),j.item)if(j.back_order_allowed&&"No"===j.back_order_allowed.text)b(l,"bg-orange");else{"T"==j.on_hold&&b(l,"bg-yellow");var m=j.item&&j.item.text,n=e[m];n>=0?b(l,"text-bright-green"):b(l,"text-red")}else b(l,"bg-mainorder")}h.stop(),setTimeout(function(){a.afterGridComplete()},10)}catch(a){console.error("Error in onGridComplete:",a)}c.stop()},addData:function(a,b){if(this.data=d(a,b),!this.data||this.data.length<=0){var c=StopWatch.start("clearGridData()");this.$grid.clearGridData(),c.stop()}else{var e=StopWatch.start("addJSONData()");this.$grid[0].addJSONData(this.data),e.stop()}},preselectFilters:function(){var a=$(".status-dropdown option");a.first().prop("selected",!0)},bindGrid:function(){var a=this;this.$grid.jqGrid({styleUI:"Bootstrap",datatype:function(b){a.fetchGridData(b)},idPrefix:"row_",shrinkToFit:!1,loadui:"block",hoverrows:!1,pgbuttons:!1,pgtext:null,beforeSelectRow:function(a,b){return!1},onSelectRow:function(){return!1},onRightClickRow:function(){a.$grid.jqGrid("resetSelection")},gridComplete:function(){a.onGridCompleteInner()},colModel:[{sortable:!1,hidden:!0,label:"",name:"guid",key:!0},{sortable:!1,label:"Approve",name:"id",width:70,formatter:this.createPrintCheckbox},{sortable:!1,label:"Print",name:"prid",width:60,formatter:this.createApproveCheckbox},{sortable:!1,label:"Email",name:"emid",width:60,formatter:this.createEmailCheckbox},{sortable:!1,label:"Close",name:"line_id",width:50,formatter:this.createCloseCheckbox},{sortable:!1,label:"Entered By / Status",name:"status",width:125},{sortable:!1,label:"Date / Partner",name:"date_partner",width:108},{sortable:!1,hidden:!0,label:"Partner",name:"partner.text",width:200},{sortable:!1,label:"Number",name:"number",width:100,formatter:this.createSalesOrderLink},{sortable:!1,label:"Ship Date",name:"ship_date",width:140,formatter:this.createShipDatePicker},{sortable:!1,label:"Cancel Date",name:"cancel_date",width:130,formatter:this.createCancelDatePicker},{sortable:!1,label:"Closed Reason",name:"closed_reason",width:150,formatter:this.createClosedReasonPicker},{sortable:!1,hidden:!0,label:"Name",name:"name.text",width:300,hidden:!0,formatter:this.createCustomerNameLink},{sortable:!1,label:"Item",name:"item.text",width:100,formatter:this.createItemPicker},{sortable:!1,label:"PO / Item Description",name:"item_description",width:200,formatter:this.createItemDescriptionLink},{sortable:!1,label:"Next Receipt",name:"next_receipt",width:100},{sortable:!1,label:"Open Quantity",name:"swap_quantity",width:110,formatter:this.createItemSwapInt},{sortable:!1,label:"Total Available Quantity",name:"cust_total_available_quantity",width:170},{sortable:!1,label:"On Hand",name:"on_hand",width:75},{sortable:!1,label:"Values",name:"values",width:80},{sortable:!1,label:"Substitute",name:"substitute.text",width:100}],viewrecords:!1,height:600,rowNum:1e3,pager:"#jqGridPager"})}};return f}),PPTUIManager=UIManager.extend(function(a){function b(a,b){a.className.indexOf(b)===-1&&(a.className+=" "+b)}var c={onGridCompleteInner:function(){console.log("onGridCompleteInner()",arguments);var a=this,c=StopWatch.start("onGridComplete()"),d=$(".ui-jqgrid"),e=$(".ui-jqgrid-bdiv"),f=$(".empty-grid-message");try{if(e.scrollTop(0),!this.data||this.data.length<=0)return d.hide(),void f.show();f.hide(),d.show();for(var g=StopWatch.start("for ._data()"),h=0;h<this.data.length;h++){var i=this.data[h],j="row_"+i.guid,k=document.getElementById(j);k&&(k.setAttribute("data-is-mainline",!i.item),k.setAttribute("data-salesorder-id",i.id),k.setAttribute("data-line-id",i.line_id),i.item?("T"==i.on_hold?b(k,"bg-yellow"):i.back_order_allowed&&"No"===i.back_order_allowed.text&&b(k,"bg-orange"),0==i.quantity_committed?b(k,"text-brown"):0==parseInt(i.remaining_quantity)&&b(k,"text-green")):b(k,"bg-mainorder"))}g.stop(),setTimeout(function(){a.afterGridComplete()},10)}catch(a){console.error("Error in onGridComplete:",a)}c.stop()},addData:function(a){if(this.data=a,!this.data||this.data.length<=0){var b=StopWatch.start("clearGridData()");this.$grid.clearGridData(),b.stop()}else{var c=StopWatch.start("addJSONData()");this.$grid[0].addJSONData(this.data),c.stop()}},preselectFilters:function(){var a=$(".status-dropdown option");a.filter('[value="SalesOrd:B"], [value="SalesOrd:D"]').prop("selected",!0)},bindGrid:function(){var a=this;this.$grid.jqGrid({styleUI:"Bootstrap",datatype:function(b){a.fetchGridData(b)},idPrefix:"row_",shrinkToFit:!1,loadui:"block",hoverrows:!1,pgbuttons:!1,pgtext:null,beforeSelectRow:function(a,b){return!1},onSelectRow:function(){return!1},onRightClickRow:function(){a.$grid.jqGrid("resetSelection")},gridComplete:function(){a.onGridCompleteInner()},colModel:[{sortable:!1,hidden:!0,label:"",name:"guid",key:!0},{sortable:!1,label:"Print",name:"id",width:50,formatter:this.createPrintCheckbox},{sortable:!1,label:"Close",name:"line_id",width:50,formatter:this.createCloseCheckbox},{sortable:!1,label:"Date / Partner",name:"date_partner",width:108},{sortable:!1,hidden:!0,label:"Partner",name:"partner.text",width:200},{sortable:!1,label:"Status / Customer",name:"status",width:200,formatter:this.createStatusAndCustomerNameLink},{sortable:!1,label:"Number",name:"number_nextreceipt",width:100,formatter:this.createSalesOrderLink},{sortable:!1,label:"Ship Date",name:"ship_date",width:130,formatter:this.createShipDatePicker},{sortable:!1,label:"Cancel Date",name:"cancel_date",width:130,formatter:this.createCancelDatePicker},{sortable:!1,label:"Closed Reason",name:"closed_reason",width:150,formatter:this.createClosedReasonPicker},{sortable:!1,hidden:!0,label:"Name",name:"name.text",width:300,formatter:this.createCustomerNameLink},{sortable:!1,label:"Item",name:"item.text",width:300,formatter:this.createItemPicker},{sortable:!1,label:"Item Description",name:"item_description",width:200,formatter:this.createItemDescriptionLink},{sortable:!1,label:"Next Receipt",name:"next_receipt",width:100},{sortable: !1,  label: "Open Quantity", name: "swap_quantity", width: 110, formatter: this.createItemSwapInt},{sortable:!1,label:"Com Qty",name:"quantity_committed",width:100},{sortable:!1,hidden:!0,label:"Quantity Packed",name:"quantity_packed",width:100},{sortable:!1,label:"On Hand",name:"on_hand",width:75},{sortable:!1,label:"On Order",name:"on_order",width:80},{sortable:!1,hidden:!0,label:"Next Receipt",name:"next_receipt",width:100},{sortable:!1,label:"Values",name:"values",width:80},{sortable:!1,label:"Com Value",name:"committed_value",width:150}],viewrecords:!1,height:800,rowNum:1e3,pager:"#jqGridPager"})}};return c});$(document).ready(function(){var a={createUIManager:function(a){return"OrderReview"===a?new OrderReviewUIManager(a):new PPTUIManager(a)}};a.createUIManager(window.pageType)});